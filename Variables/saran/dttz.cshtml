@inherits avt.MyTokens.Core.ParsingEngine.RazorTemplate
@{
    var result = "";

    string dateTimeString = Tokens.TknParams.DateTime.ToString();
    string offsetString = Tokens.TknParams.OffsetMinutes.ToString();
    double offset = double.Parse(offsetString);
    var offsetTS = TimeSpan.FromMinutes(offset);
    var dateTime = ParseDate(dateTimeString);

    dateTime = dateTime.Subtract(offsetTS - dateTime.Offset).ToOffset(offsetTS);

    result = dateTime.ToString("o");

}

@result

@functions {
    public DateTimeOffset ParseDate(string dateTimeString) {
        try {
            return System.DateTimeOffset.ParseExact(dateTimeString, "dd MMMM yyyy HH:mm", System.Globalization.CultureInfo.InvariantCulture);
        } catch (Exception ex) {
            throw new Exception("Could not parse date. Accepted format: dd MMMM yyyy HH:mm", ex);
        }
    }
}